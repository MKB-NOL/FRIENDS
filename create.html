<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Quiz | FRIENDS</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="style.css">
    <script src="https://richinfo.co/richpartners/in-page/js/richads-ob.js?pubid=997197&siteid=381604" async></script>
    <!-- Firebase v8 for compatibility -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <a href="index.html" style="text-decoration: none;">
                    <div class="logo" style="font-size: 32px;">Fâ€¢Râ€¢Iâ€¢Eâ€¢Nâ€¢Dâ€¢S</div>
                </a>
                <div id="selected-count" style="background: red; color: white; padding: 8px 16px; border-radius: 20px; font-weight: 600;">
                    0/10
                </div>
            </header>

        <div class="line"></div>

        <!-- Nickname Section -->
        <div class="card">
            <div class="input-group">
                <label class="input-label"><i class='bx bx-user' style="color: red;"></i> Your Nickname</label>
                <input type="text" id="nickname" class="input-field" placeholder="e.g., CaptainAwesome" maxlength="20">
                <p style="color: #666; font-size: 14px; margin-top: 8px;">This name will appear on the scoreboard</p>
            </div>
        </div>

        <div class="progress-container">
            <div id="progress-bar" class="progress-bar"></div>
        </div>

        <p id="selection-counter" class="selection-counter">Select 10 questions about yourself</p>

        <!-- Questions List -->
        <div id="questions-container">
            <!-- Questions will be loaded here by JavaScript -->
        </div>

        <button id="create-btn" class="btn" disabled>
            <i class='bx bx-check-circle'></i> Create My Quiz
        </button>

        <div class="line"></div>

        <footer>
            <div class="footer-links">
                <a href="index.html"><i class='bx bx-home'></i> Home</a>
                <a href="privacy.html">Privacy</a>
                <a href="terms.html">Terms</a>
            </div>
        </footer>
    </div>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyALNlMLF-Fxu87Ge5yfhp2m1R-vU58XcLo",
            authDomain: "besides-sm.firebaseapp.com",
            projectId: "besides-sm",
            storageBucket: "besides-sm.firebasestorage.app",
            messagingSenderId: "897908486036",
            appId: "1:897908486036:web:e39140f75bec1b4d4de981",
            measurementId: "G-BB0NMVRFLY"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const analytics = firebase.analytics();

        // Questions Database (20 questions)
        const QUESTIONS = [
            {
                id: 1,
                text: "What would I save first in a fire?",
                options: ["Phone ðŸ“±", "Photo albums ðŸ“¸", "Laptop ðŸ’»", "Favorite hoodie ðŸ‘•", "Pet ðŸ¾", "Myself! ðŸƒâ€â™‚ï¸"]
            },
            {
                id: 2,
                text: "What would I do on a perfect weekend?",
                options: ["Netflix marathon ðŸ“º", "Outdoor adventure ðŸ•ï¸", "Party with friends ðŸŽ‰", "Sleep all day ðŸ˜´", "Try new restaurants ðŸ½ï¸", "Read books ðŸ“š"]
            },
            {
                id: 3,
                text: "What's my favorite color?",
                options: ["Red â¤ï¸", "Blue ðŸ’™", "Green ðŸ’š", "Black âš«", "White âšª", "Rainbow ðŸŒˆ"]
            },
            {
                id: 4,
                text: "What's my hidden talent?",
                options: ["Great cook ðŸ‘¨â€ðŸ³", "Can sing well ðŸŽµ", "Speaks multiple languages ðŸ—£ï¸", "Really good at trivia ðŸ§ ", "Great dancer ðŸ’ƒ", "I'm secretly average! ðŸ¤«"]
            },
            {
                id: 5,
                text: "What's my dream vacation destination?",
                options: ["Bali ðŸŒ´", "Japan ðŸ—¾", "Italy ðŸ›ï¸", "New Zealand ðŸ”ï¸", "Maldives ðŸï¸", "Anywhere with a beach! ðŸŒŠ"]
            },
            {
                id: 6,
                text: "What's my movie category?",
                options: ["Action ðŸ’¥", "Romance ðŸ’•", "Comedy ðŸ˜‚", "Horror ðŸ‘»", "Sci-fi ðŸš€", "Animated ðŸŽ¬"]
            },
            {
                id: 7,
                text: "What's my favorite type of food?",
                options: ["Italian ðŸ", "Mexican ðŸŒ®", "Chinese ðŸ¥¡", "Indian ðŸ›", "Burgers ðŸ”", "Sushi ðŸ£"]
            },
            {
                id: 8,
                text: "What's my go-to karaoke song?",
                options: ["Don't Stop Believin' ðŸŽ¤", "Bohemian Rhapsody ðŸŽ¸", "Wannabe ðŸ‘¯â€â™€ï¸", "Shape of You ðŸŽ¶", "Sweet Caroline ðŸ‘", "I don't sing! ðŸ™Š"]
            },
            {
                id: 9,
                text: "What's my biggest pet peeve?",
                options: ["Being late â°", "Loud chewing ðŸ¤¢", "Bad texting etiquette ðŸ“±", "People who don't listen ðŸ‘‚", "Messy spaces ðŸ—‘ï¸", "Rude people ðŸ˜ "]
            },
            {
                id: 10,
                text: "What superpower would I choose?",
                options: ["Invisibility ðŸ‘»", "Flight ðŸ¦¸â€â™‚ï¸", "Time travel â³", "Teleportation âœ¨", "Mind reading ðŸ§ ", "Super strength ðŸ’ª"]
            },
            {
                id: 11,
                text: "What's my coffee order?",
                options: ["Black coffee â˜•", "Latte with oat milk ðŸ¥›", "I don't drink coffee âŒ", "Sweet frappuccino ðŸ¦", "Espresso shot âš¡", "Tea instead! ðŸµ"]
            },
            {
                id: 12,
                text: "What emoji do I use the most?",
                options: ["ðŸ˜‚", "â¤ï¸", "ðŸ”¥", "ðŸ˜­", "ðŸ¤”", "âœ¨"]
            },
            {
                id: 13,
                text: "How do I handle stress?",
                options: ["Exercise ðŸƒâ€â™€ï¸", "Eat junk food ðŸ•", "Talk to friends ðŸ—£ï¸", "Play video games ðŸŽ®", "Listen to music ðŸŽ§", "Sleep it off ðŸ˜´"]
            },
            {
                id: 14,
                text: "What's my signature style?",
                options: ["Comfortable ðŸ‘Ÿ", "Trendy ðŸ‘•", "Classic ðŸ‘”", "Sporty ðŸ€", "Mix of everything ðŸŽ¨", "Pajamas all day! ðŸ›ï¸"]
            },
            {
                id: 15,
                text: "What reality show would I survive on?",
                options: ["Survivor ðŸï¸", "The Amazing Race ðŸŒ", "Big Brother ðŸ ", "Love Island â¤ï¸", "Naked and Afraid ðŸ¥¶", "I'd be voted off first! ðŸšª"]
            },
            {
                id: 16,
                text: "What's my guilty pleasure?",
                options: ["Reality TV ðŸ“º", "Junk food ðŸ«", "Social media ðŸ“±", "Rom-coms ðŸ’•", "Shopping ðŸ›ï¸", "All of the above! ðŸ™ˆ"]
            },
            {
                id: 17,
                text: "How do I celebrate Christmas?",
                options: ["Big family dinner ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦", "Quiet at home ðŸ ", "Travel somewhere âœˆï¸", "Lots of parties ðŸŽ‰", "Volunteering â¤ï¸", "All about the food! ðŸª"]
            },
            {
                id: 18,
                text: "What makes me laugh the most?",
                options: ["Dad jokes ðŸ˜‚", "Memes ðŸ“±", "Silly animal videos ðŸ¶", "Friends' stories ðŸ‘¯", "Awkward situations ðŸ˜…", "Everything! ðŸ¤£"]
            },
            {
                id: 19,
                text: "What's my favorite sport to watch?",
                options: ["Soccer âš½", "Basketball ðŸ€", "Tennis ðŸŽ¾", "Esports ðŸŽ®", "None, I don't watch sports ðŸ™…â€â™‚ï¸", "All sports! ðŸ†"]
            },
            {
                id: 20,
                text: "What's my ideal Friday night?",
                options: ["Movie night ðŸŽ¬", "Club dancing ðŸ’ƒ", "Dinner with friends ðŸ½ï¸", "Video games ðŸŽ®", "Early sleep ðŸ˜´", "Something spontaneous! ðŸŽ²"]
            }
        ];

        let selectedQuestions = new Set();
        let selectedAnswers = {};

        // Load questions on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadQuestions();
            
            // Set up event listeners
            document.getElementById('create-btn').addEventListener('click', createQuiz);
            document.getElementById('nickname').addEventListener('input', validateForm);
        });

        function loadQuestions() {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';
            
            // Shuffle questions
            const shuffledQuestions = [...QUESTIONS].sort(() => Math.random() - 0.5);
            
            shuffledQuestions.forEach(question => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.dataset.id = question.id;
                
                questionCard.innerHTML = `
                    <div class="question-text">${question.text}</div>
                    <div class="question-options">
                        ${question.options.slice(0, 3).map(option => `
                            <span class="option">${option}</span>
                        `).join('')}
                        ${question.options.length > 3 ? `<span class="option">+${question.options.length - 3} more</span>` : ''}
                    </div>
                `;
                
                questionCard.addEventListener('click', () => {
                    toggleQuestionSelection(question.id, question.options[0]);
                });
                
                container.appendChild(questionCard);
            });
        }

        function toggleQuestionSelection(questionId, selectedOption) {
            const questionCard = document.querySelector(`[data-id="${questionId}"]`);
            
            if (selectedQuestions.has(questionId)) {
                // Deselect
                selectedQuestions.delete(questionId);
                delete selectedAnswers[questionId];
                questionCard.classList.remove('selected');
            } else {
                // Select if we have less than 10
                if (selectedQuestions.size < 10) {
                    selectedQuestions.add(questionId);
                    selectedAnswers[questionId] = selectedOption;
                    questionCard.classList.add('selected');
                    
                    // Add subtle animation
                    questionCard.style.transform = 'scale(0.98)';
                    setTimeout(() => {
                        questionCard.style.transform = 'scale(1)';
                    }, 100);
                } else {
                    // Show notification
                    showNotification('Maximum 10 questions allowed!');
                    return;
                }
            }
            
            updateSelectionUI();
            validateForm();
        }

        function updateSelectionUI() {
            const count = selectedQuestions.size;
            const countElement = document.getElementById('selected-count');
            const progressBar = document.getElementById('progress-bar');
            const counterText = document.getElementById('selection-counter');
            
            countElement.textContent = `${count}/10`;
            progressBar.style.width = `${(count / 10) * 100}%`;
            
            if (count === 10) {
                counterText.innerHTML = '<i class="bx bx-check" style="color: red;"></i> All 10 questions selected!';
                countElement.style.background = '#25D366'; // Green when complete
            } else {
                counterText.textContent = `Select ${10 - count} more questions`;
                countElement.style.background = 'red';
            }
        }

        function validateForm() {
            const nickname = document.getElementById('nickname').value.trim();
            const createBtn = document.getElementById('create-btn');
            
            if (nickname.length >= 2 && selectedQuestions.size === 10) {
                createBtn.disabled = false;
                createBtn.innerHTML = '<i class="bx bx-check-circle"></i> Create My Quiz';
            } else {
                createBtn.disabled = true;
                createBtn.innerHTML = '<i class="bx bx-check-circle"></i> Select 10 Questions';
            }
        }

        async function createQuiz() {
            const nickname = document.getElementById('nickname').value.trim();
            
            if (!nickname || selectedQuestions.size !== 10) {
                showNotification('Please complete all requirements!');
                return;
            }
            
            // Show loading
            const btn = document.getElementById('create-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="bx bx-loader-alt bx-spin"></i> Creating...';
            btn.disabled = true;
            
            try {
                // Prepare quiz data
                const quizData = {
                    ownerName: nickname,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    questions: Array.from(selectedQuestions).map(id => {
                        const question = QUESTIONS.find(q => q.id === id);
                        return {
                            id: question.id,
                            text: question.text,
                            options: question.options,
                            correctAnswer: selectedAnswers[question.id]
                        };
                    })
                };
                
                // Save to Firestore
                const quizRef = await db.collection('quizzes').add(quizData);
                const quizId = quizRef.id;
                
                // Track analytics
                analytics.logEvent('quiz_created');
                
                // Redirect to share page
                window.location.href = `share.html?quiz=${quizId}`;
                
            } catch (error) {
                console.error('Error creating quiz:', error);
                showNotification('Error creating quiz. Please try again!');
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        function showNotification(message) {
            // Remove existing notification
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();
            
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>
