<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Quiz | FRIENDS</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="style.css">
    <script src="https://richinfo.co/richpartners/in-page/js/richads-ob.js?pubid=997197&siteid=381604" async></script>
    <!-- Firebase v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" style="text-decoration: none;">
                <div class="logo">
                    <span style="color: #FF6B6B;">F</span><span class="logo-dot" style="color: #FF9800;">â€¢</span>
                    <span style="color: #4CAF50;">R</span><span class="logo-dot" style="color: #9C27B0;">â€¢</span>
                    <span style="color: #2196F3;">I</span><span class="logo-dot" style="color: #FF5722;">â€¢</span>
                    <span style="color: #FFC107;">E</span><span class="logo-dot" style="color: #795548;">â€¢</span>
                    <span style="color: #673AB7;">N</span><span class="logo-dot" style="color: #00BCD4;">â€¢</span>
                    <span style="color: #E91E63;">D</span><span class="logo-dot" style="color: #8BC34A;">â€¢</span>
                    <span style="color: #3F51B5;">S</span>
                </div>
            </a>
            <div id="selected-count" style="background: var(--primary-color); color: white; padding: 6px 12px; border-radius: 15px; font-weight: 600; font-size: 13px; display: inline-block; margin-top: 8px;">
                0/10
            </div>
        </header>

        <div class="line"></div>

        <!-- Nickname Section -->
        <div class="card">
            <div class="input-group">
                <label class="input-label"><i class='bx bx-user' style="color: var(--primary-color);"></i> Your Nickname</label>
                <input type="text" id="nickname" class="input-field" placeholder="e.g., SantaHelper" maxlength="20">
                <p style="color: #666; font-size: 12px; margin-top: 6px;">This name will appear on the scoreboard</p>
            </div>
        </div>

        <div class="progress-container">
            <div id="progress-bar" class="progress-bar"></div>
        </div>

        <p id="selection-counter" class="selection-counter">ðŸŽ„ Select 10 Christmas questions about yourself ðŸŽ…</p>

        <!-- Questions List -->
        <div id="questions-container">
            <!-- Questions will be loaded here by JavaScript -->
        </div>

        <button id="create-btn" class="btn" disabled>
            <i class='bx bx-check-circle'></i> Create My Quiz
        </button>

        <div class="line"></div>

        <footer>
            <div class="footer-links">
                <a href="index.html"><i class='bx bx-home'></i> Home</a>
                <a href="privacy.html">Privacy</a>
                <a href="terms.html">Terms</a>
            </div>
        </footer>
    </div>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyALNlMLF-Fxu87Ge5yfhp2m1R-vU58XcLo",
            authDomain: "besides-sm.firebaseapp.com",
            projectId: "besides-sm",
            storageBucket: "besides-sm.firebasestorage.app",
            messagingSenderId: "897908486036",
            appId: "1:897908486036:web:e39140f75bec1b4d4de981",
            measurementId: "G-BB0NMVRFLY"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Questions Database (20 Christmas-themed questions)
        const QUESTIONS = [
            {
                id: 1,
                text: "What would I save first in a Christmas fire? ðŸŽ„ðŸ”¥",
                options: ["Christmas gifts ðŸŽ", "Phone with family photos ðŸ“±", "Favorite Christmas sweater ðŸ‘•", "Pet under the tree ðŸ¾"]
            },
            {
                id: 2,
                text: "What would I do on a perfect Christmas weekend? ðŸŽ…",
                options: ["Watch Christmas movies all day ðŸŽ¬", "Build a snowman outside â›„", "Christmas party with friends ðŸŽ‰", "Sleep after big dinner ðŸ˜´"]
            },
            {
                id: 3,
                text: "What's my favorite Christmas color? ðŸŽ¨",
                options: ["Christmas Red â¤ï¸", "Snow White â›„", "Christmas Green ðŸŽ„", "Gold Star â­"]
            },
            {
                id: 4,
                text: "What's my hidden Christmas talent? ðŸŽ",
                options: ["Best gift wrapper ðŸŽ€", "Christmas carol singer ðŸŽµ", "Cookie baker ðŸª", "Christmas tree decorator ðŸŽ„"]
            },
            {
                id: 5,
                text: "Where's my dream Christmas vacation? âœˆï¸",
                options: ["Lapland to meet Santa ðŸŽ…", "Christmas in New York ðŸ—½", "Beach Christmas ðŸŒ´", "Christmas market in Europe ðŸ°"]
            },
            {
                id: 6,
                text: "What's my favorite Christmas movie? ðŸŽ¬",
                options: ["Home Alone ðŸ˜‚", "The Grinch ðŸ‘º", "Elf ðŸ§", "Love Actually â¤ï¸"]
            },
            {
                id: 7,
                text: "What's my favorite Christmas food? ðŸ½ï¸",
                options: ["Christmas cookies ðŸª", "Turkey dinner ðŸ¦ƒ", "Christmas ham ðŸ–", "Hot chocolate â˜•"]
            },
            {
                id: 8,
                text: "What's my go-to Christmas song? ðŸŽµ",
                options: ["Last Christmas ðŸŽ¤", "All I Want for Christmas â¤ï¸", "Jingle Bell Rock ðŸ””", "Silent Night ðŸŒƒ"]
            },
            {
                id: 9,
                text: "What's my Christmas pet peeve? ðŸ˜ ",
                options: ["Early Christmas music ðŸŽµ", "Bad gift wrappers ðŸŽ", "Fake snow â„ï¸", "Overcooked turkey ðŸ¦ƒ"]
            },
            {
                id: 10,
                text: "What Christmas superpower would I choose? ðŸ¦¸â€â™‚ï¸",
                options: ["Deliver all gifts instantly ðŸŽ", "Make snow anywhere â„ï¸", "Perfect gift ideas ðŸ’¡", "Endless Christmas cookies ðŸª"]
            },
            {
                id: 11,
                text: "What's my Christmas morning drink? â˜•",
                options: ["Hot chocolate with marshmallows â˜•", "Christmas coffee â˜•", "Orange juice ðŸŠ", "Eggnog ðŸ¥›"]
            },
            {
                id: 12,
                text: "What's my most used Christmas emoji? âœ¨",
                options: ["ðŸŽ„", "ðŸŽ…", "ðŸŽ", "â„ï¸"]
            },
            {
                id: 13,
                text: "How do I handle Christmas stress? ðŸŽ„",
                options: ["Eat more cookies ðŸª", "Watch Christmas movies ðŸŽ¬", "Go shopping ðŸ›ï¸", "Take a nap ðŸ˜´"]
            },
            {
                id: 14,
                text: "What's my Christmas style? ðŸ‘•",
                options: ["Ugly Christmas sweater ðŸŽ„", "Cozy pajamas ðŸ›ï¸", "Festive dress ðŸ‘—", "Santa costume ðŸŽ…"]
            },
            {
                id: 15,
                text: "Which Christmas show would I survive on? ðŸ“º",
                options: ["Baking competition ðŸª", "Christmas decorating ðŸŽ„", "Gift wrapping ðŸŽ", "Carol singing ðŸŽµ"]
            },
            {
                id: 16,
                text: "What's my Christmas guilty pleasure? ðŸŽ",
                options: ["Eating cookies for breakfast ðŸª", "Opening gifts early ðŸŽ", "Watching same movies yearly ðŸŽ¬", "All the food! ðŸ½ï¸"]
            },
            {
                id: 17,
                text: "How do I celebrate Christmas Eve? ðŸŒƒ",
                options: ["Family dinner ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦", "Church service â›ª", "Presents under tree ðŸŽ", "Christmas movie marathon ðŸŽ¬"]
            },
            {
                id: 18,
                text: "What makes me laugh most at Christmas? ðŸ˜‚",
                options: ["Family stories ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦", "Funny gifts ðŸŽ", "Christmas fails ðŸ˜…", "Santa jokes ðŸŽ…"]
            },
            {
                id: 19,
                text: "What's my favorite Christmas sport? ðŸ€",
                options: ["Ice skating â›¸ï¸", "Snowball fight â„ï¸", "Skiing ðŸŽ¿", "Watching by the fire ðŸ”¥"]
            },
            {
                id: 20,
                text: "What's my ideal Christmas night? ðŸŒ™",
                options: ["By the fireplace ðŸ”¥", "Christmas lights drive ðŸš—", "Board games ðŸŽ²", "Early sleep ðŸ˜´"]
            }
        ];

        let selectedQuestions = [];
        let selectedAnswers = {};

        // Load questions on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadQuestions();
            
            // Set up event listeners
            document.getElementById('create-btn').addEventListener('click', createQuiz);
            document.getElementById('nickname').addEventListener('input', validateForm);
            
            // Apply theme
            applyTheme();
        });

        function applyTheme() {
            const themes = ['red', 'blue', 'green', 'orange', 'violet'];
            const currentDate = new Date();
            const month = currentDate.getMonth() + 1;
            
            if (month === 12) {
                document.body.classList.add('theme-christmas');
            } else {
                const randomTheme = themes[Math.floor(Math.random() * themes.length)];
                document.body.classList.add('theme-' + randomTheme);
            }
        }

        function loadQuestions() {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';
            
            // Shuffle questions
            const shuffledQuestions = [...QUESTIONS].sort(() => Math.random() - 0.5);
            
            shuffledQuestions.forEach(question => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.dataset.id = question.id;
                
                questionCard.innerHTML = `
                    <div class="question-text">${question.text}</div>
                    <div class="answer-preview">
                        ${question.options.map(option => `
                            <span>${option}</span>
                        `).join('')}
                    </div>
                    <div style="color: var(--primary-color); font-size: 12px; margin-top: 8px; display: none;" class="selected-answer">
                        <i class='bx bx-check'></i> Selected: <span class="selected-text"></span>
                    </div>
                `;
                
                questionCard.addEventListener('click', () => {
                    showAnswerSelection(question.id);
                });
                
                container.appendChild(questionCard);
            });
        }

        function showAnswerSelection(questionId) {
            const question = QUESTIONS.find(q => q.id === questionId);
            const questionCard = document.querySelector(`[data-id="${questionId}"]`);
            
            // Create answer selection modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 12px; padding: 20px; max-width: 400px; width: 100%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="font-size: 16px; color: var(--primary-color);">Select Answer</h3>
                        <button id="close-modal" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #666;">Ã—</button>
                    </div>
                    
                    <div class="question-text" style="margin-bottom: 20px; font-size: 15px;">${question.text}</div>
                    
                    <div class="answer-options">
                        ${question.options.map((option, index) => `
                            <div class="answer-option ${selectedAnswers[questionId] === option ? 'selected' : ''}" 
                                 data-option="${option}">
                                ${option}
                            </div>
                        `).join('')}
                    </div>
                    
                    <button id="save-answer" class="btn" style="margin-top: 20px;">
                        <i class='bx bx-save'></i> Save Answer
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listeners
            document.getElementById('close-modal').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            const answerOptions = modal.querySelectorAll('.answer-option');
            let selectedOption = selectedAnswers[questionId];
            
            answerOptions.forEach(option => {
                option.addEventListener('click', () => {
                    answerOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    selectedOption = option.dataset.option;
                });
            });
            
            document.getElementById('save-answer').addEventListener('click', () => {
                if (selectedOption) {
                    saveAnswer(questionId, selectedOption, questionCard);
                    document.body.removeChild(modal);
                } else {
                    showNotification('Please select an answer!');
                }
            });
            
            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }

        function saveAnswer(questionId, answer, questionCard) {
            // Check if question already selected
            const existingIndex = selectedQuestions.indexOf(questionId);
            
            if (existingIndex === -1) {
                // Add new question if less than 10
                if (selectedQuestions.length < 10) {
                    selectedQuestions.push(questionId);
                    selectedAnswers[questionId] = answer;
                    questionCard.classList.add('selected');
                    
                    // Show selected answer
                    const selectedText = questionCard.querySelector('.selected-text');
                    const selectedDiv = questionCard.querySelector('.selected-answer');
                    selectedText.textContent = answer;
                    selectedDiv.style.display = 'block';
                } else {
                    showNotification('Maximum 10 questions allowed!');
                    return;
                }
            } else {
                // Update existing answer
                selectedAnswers[questionId] = answer;
                const selectedText = questionCard.querySelector('.selected-text');
                selectedText.textContent = answer;
            }
            
            updateSelectionUI();
            validateForm();
        }

        function updateSelectionUI() {
            const count = selectedQuestions.length;
            const countElement = document.getElementById('selected-count');
            const progressBar = document.getElementById('progress-bar');
            const counterText = document.getElementById('selection-counter');
            
            countElement.textContent = `${count}/10`;
            progressBar.style.width = `${(count / 10) * 100}%`;
            
            if (count === 10) {
                counterText.innerHTML = '<i class="bx bx-check" style="color: var(--primary-color);"></i> All 10 questions selected!';
                countElement.style.background = '#25D366';
            } else {
                counterText.textContent = `Select ${10 - count} more questions`;
                countElement.style.background = 'var(--primary-color)';
            }
        }

        function validateForm() {
            const nickname = document.getElementById('nickname').value.trim();
            const createBtn = document.getElementById('create-btn');
            
            if (nickname.length >= 2 && selectedQuestions.length === 10) {
                createBtn.disabled = false;
                createBtn.innerHTML = '<i class="bx bx-check-circle"></i> Create My Quiz';
            } else {
                createBtn.disabled = true;
                createBtn.innerHTML = '<i class="bx bx-check-circle"></i> Select 10 Questions';
            }
        }

        async function createQuiz() {
            const nickname = document.getElementById('nickname').value.trim();
            
            if (!nickname || selectedQuestions.length !== 10) {
                showNotification('Please complete all requirements!');
                return;
            }
            
            // Show loading
            const btn = document.getElementById('create-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="bx bx-loader-alt bx-spin"></i> Creating...';
            btn.disabled = true;
            
            try {
                // Prepare quiz data
                const quizData = {
                    ownerName: nickname,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    questions: selectedQuestions.map(id => {
                        const question = QUESTIONS.find(q => q.id === id);
                        return {
                            id: question.id,
                            text: question.text,
                            options: question.options,
                            correctAnswer: selectedAnswers[id]
                        };
                    })
                };
                
                // Save to Firestore
                const quizRef = await db.collection('quizzes').add(quizData);
                const quizId = quizRef.id;
                
                // Save to local storage for history
                saveQuizToHistory(quizId, nickname);
                
                // Redirect to share page
                window.location.href = `share.html?quiz=${quizId}`;
                
            } catch (error) {
                console.error('Error creating quiz:', error);
                showNotification('Error creating quiz. Please try again!');
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        function saveQuizToHistory(quizId, nickname) {
            const history = JSON.parse(localStorage.getItem('friends_quiz_history') || '[]');
            history.unshift({
                id: quizId,
                name: nickname,
                date: new Date().toISOString()
            });
            
            // Keep only last 10 quizzes
            if (history.length > 10) {
                history.pop();
            }
            
            localStorage.setItem('friends_quiz_history', JSON.stringify(history));
        }

        function showNotification(message) {
            // Remove existing notification
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();
            
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>
