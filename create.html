<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Quiz | FRIENDS</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="style.css">
    <script src="https://richinfo.co/richpartners/in-page/js/richads-ob.js?pubid=997197&siteid=381604" async></script>
    <!-- Firebase v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" style="text-decoration: none;">
                <div class="logo">
                    <span style="color: #FF4444;">F</span><span class="logo-dot" style="color: #FF9800;">â€¢</span>
                    <span style="color: #2ECC71;">R</span><span class="logo-dot" style="color: #9C27B0;">â€¢</span>
                    <span style="color: #4A90E2;">I</span><span class="logo-dot" style="color: #FF5722;">â€¢</span>
                    <span style="color: #FFC107;">E</span><span class="logo-dot" style="color: #795548;">â€¢</span>
                    <span style="color: #673AB7;">N</span><span class="logo-dot" style="color: #00BCD4;">â€¢</span>
                    <span style="color: #E91E63;">D</span><span class="logo-dot" style="color: #8BC34A;">â€¢</span>
                    <span style="color: #3F51B5;">S</span>
                </div>
            </a>
            <div id="selected-count" style="background: var(--primary-color); color: white; padding: 5px 10px; border-radius: 12px; font-weight: 600; font-size: 12px; display: inline-block; margin-top: 6px;">
                0/10
            </div>
        </header>

        <div class="line"></div>

        <!-- Nickname Section -->
        <div class="card">
            <div class="input-group">
                <label class="input-label"><i class='bx bx-user' style="color: var(--primary-color);"></i> Your Nickname</label>
                <input type="text" id="nickname" class="input-field" placeholder="e.g., SuperFriend" maxlength="20">
                <p style="color: #666; font-size: 11px; margin-top: 5px;">This name will appear on the scoreboard</p>
            </div>
        </div>

        <div class="progress-container">
            <div id="progress-bar" class="progress-bar"></div>
        </div>

        <p id="selection-counter" class="selection-counter">Select 10 questions about yourself</p>

        <!-- Questions List -->
        <div id="questions-container">
            <!-- Questions will be loaded here by JavaScript -->
        </div>

        <button id="create-btn" class="btn" disabled>
            <i class='bx bx-check-circle'></i> Create My Quiz
        </button>

        <div class="line"></div>

        <footer>
            <div class="footer-links">
                <a href="index.html"><i class='bx bx-home'></i> Home</a>
                <a href="privacy.html">Privacy</a>
                <a href="terms.html">Terms</a>
            </div>
        </footer>
    </div>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyALNlMLF-Fxu87Ge5yfhp2m1R-vU58XcLo",
            authDomain: "besides-sm.firebaseapp.com",
            projectId: "besides-sm",
            storageBucket: "besides-sm.firebasestorage.app",
            messagingSenderId: "897908486036",
            appId: "1:897908486036:web:e39140f75bec1b4d4de981",
            measurementId: "G-BB0NMVRFLY"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Questions Database (20 regular questions)
        const QUESTIONS = [
            {
                id: 1,
                text: "What would I save first in a fire?",
                options: ["Phone ðŸ“±", "Photo albums ðŸ“¸", "Laptop ðŸ’»", "Favorite hoodie ðŸ‘•"]
            },
            {
                id: 2,
                text: "What would I do on a perfect weekend?",
                options: ["Netflix marathon ðŸ“º", "Outdoor adventure ðŸ•ï¸", "Party with friends ðŸŽ‰", "Sleep all day ðŸ˜´"]
            },
            {
                id: 3,
                text: "What's my favorite color?",
                options: ["Red â¤ï¸", "Blue ðŸ’™", "Green ðŸ’š", "Black âš«"]
            },
            {
                id: 4,
                text: "What's my hidden talent?",
                options: ["Great cook ðŸ‘¨â€ðŸ³", "Can sing well ðŸŽµ", "Good at sports ðŸ€", "Funny storyteller ðŸ˜‚"]
            },
            {
                id: 5,
                text: "What's my dream vacation destination?",
                options: ["Bali ðŸŒ´", "Japan ðŸ—¾", "Italy ðŸ›ï¸", "New York ðŸ—½"]
            },
            {
                id: 6,
                text: "What's my favorite movie genre?",
                options: ["Action ðŸ’¥", "Comedy ðŸ˜‚", "Romance ðŸ’•", "Sci-fi ðŸš€"]
            },
            {
                id: 7,
                text: "What's my favorite type of food?",
                options: ["Italian ðŸ", "Mexican ðŸŒ®", "Chinese ðŸ¥¡", "Burgers ðŸ”"]
            },
            {
                id: 8,
                text: "What's my go-to karaoke song?",
                options: ["Don't Stop Believin' ðŸŽ¤", "Bohemian Rhapsody ðŸŽ¸", "Wannabe ðŸ‘¯â€â™€ï¸", "I don't sing! ðŸ™Š"]
            },
            {
                id: 9,
                text: "What's my biggest pet peeve?",
                options: ["Being late â°", "Loud chewing ðŸ¤¢", "Bad texting ðŸ“±", "Messy spaces ðŸ—‘ï¸"]
            },
            {
                id: 10,
                text: "What superpower would I choose?",
                options: ["Invisibility ðŸ‘»", "Flight ðŸ¦¸â€â™‚ï¸", "Time travel â³", "Mind reading ðŸ§ "]
            },
            {
                id: 11,
                text: "What's my coffee order?",
                options: ["Black coffee â˜•", "Latte ðŸ¥›", "No coffee âŒ", "Sweet drink ðŸ¦"]
            },
            {
                id: 12,
                text: "What emoji do I use the most?",
                options: ["ðŸ˜‚", "â¤ï¸", "ðŸ”¥", "ðŸ¤”"]
            },
            {
                id: 13,
                text: "How do I handle stress?",
                options: ["Exercise ðŸƒâ€â™€ï¸", "Eat food ðŸ•", "Talk to friends ðŸ—£ï¸", "Listen to music ðŸŽ§"]
            },
            {
                id: 14,
                text: "What's my signature style?",
                options: ["Comfortable ðŸ‘Ÿ", "Trendy ðŸ‘•", "Classic ðŸ‘”", "Sporty ðŸ€"]
            },
            {
                id: 15,
                text: "What reality show would I survive on?",
                options: ["Survivor ðŸï¸", "Big Brother ðŸ ", "Love Island â¤ï¸", "I'd fail! ðŸšª"]
            },
            {
                id: 16,
                text: "What's my guilty pleasure?",
                options: ["Reality TV ðŸ“º", "Junk food ðŸ«", "Social media ðŸ“±", "Rom-coms ðŸ’•"]
            },
            {
                id: 17,
                text: "How do I celebrate birthdays?",
                options: ["Big party ðŸŽ‰", "Quiet dinner ðŸ½ï¸", "Travel âœˆï¸", "Ignore it ðŸ™…â€â™‚ï¸"]
            },
            {
                id: 18,
                text: "What makes me laugh the most?",
                options: ["Dad jokes ðŸ˜‚", "Memes ðŸ“±", "Friends' stories ðŸ‘¯", "Comedy shows ðŸ“º"]
            },
            {
                id: 19,
                text: "What's my favorite sport to watch?",
                options: ["Soccer âš½", "Basketball ðŸ€", "Tennis ðŸŽ¾", "No sports ðŸ™…â€â™‚ï¸"]
            },
            {
                id: 20,
                text: "What's my ideal Friday night?",
                options: ["Movie night ðŸŽ¬", "Club ðŸ’ƒ", "Dinner out ðŸ½ï¸", "Video games ðŸŽ®"]
            }
        ];

        let selectedQuestions = [];
        let selectedAnswers = {};

        // Load questions on page load
        document.addEventListener('DOMContentLoaded', function() {
            applyTheme();
            loadSavedNickname();
            loadQuestions();
            
            // Set up event listeners
            document.getElementById('create-btn').addEventListener('click', createQuiz);
            document.getElementById('nickname').addEventListener('input', function() {
                validateForm();
                // Save nickname as user types
                if (this.value.trim().length >= 2) {
                    localStorage.setItem('friends_nickname', this.value.trim());
                }
            });
        });

        function applyTheme() {
            const themes = ['red', 'blue', 'green', 'orange', 'violet'];
            const randomTheme = themes[Math.floor(Math.random() * themes.length)];
            document.body.classList.add('theme-' + randomTheme);
        }

        function loadSavedNickname() {
            const savedNickname = localStorage.getItem('friends_nickname');
            if (savedNickname) {
                const nicknameInput = document.getElementById('nickname');
                nicknameInput.value = savedNickname;
                // Trigger validation
                setTimeout(() => validateForm(), 100);
            }
        }

        function loadQuestions() {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';
            
            // Shuffle questions
            const shuffledQuestions = [...QUESTIONS].sort(() => Math.random() - 0.5);
            
            shuffledQuestions.forEach(question => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.dataset.id = question.id;
                
                questionCard.innerHTML = `
                    <div class="question-text">${question.text}</div>
                    <div class="answer-preview">
                        ${question.options.map(option => `
                            <span>${option}</span>
                        `).join('')}
                    </div>
                    <div style="color: var(--primary-color); font-size: 11px; margin-top: 6px; display: none;" class="selected-answer">
                        <i class='bx bx-check'></i> Selected: <span class="selected-text"></span>
                    </div>
                `;
                
                questionCard.addEventListener('click', () => {
                    showAnswerSelection(question.id);
                });
                
                container.appendChild(questionCard);
            });
        }

        function showAnswerSelection(questionId) {
            const question = QUESTIONS.find(q => q.id === questionId);
            const questionCard = document.querySelector(`[data-id="${questionId}"]`);
            
            // Create answer selection modal
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            
            modal.innerHTML = `
                <div class="modal-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="font-size: 15px; color: var(--primary-color);">Select Answer</h3>
                        <button id="close-modal" style="background: none; border: none; font-size: 18px; cursor: pointer; color: #666;">Ã—</button>
                    </div>
                    
                    <div class="question-text" style="margin-bottom: 16px; font-size: 14px;">${question.text}</div>
                    
                    <div class="answer-options">
                        ${question.options.map((option, index) => `
                            <div class="answer-option ${selectedAnswers[questionId] === option ? 'selected' : ''}" 
                                 data-option="${option}">
                                ${option}
                            </div>
                        `).join('')}
                    </div>
                    
                    <button id="save-answer" class="btn" style="margin-top: 16px;">
                        <i class='bx bx-save'></i> Save Answer
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listeners
            document.getElementById('close-modal').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            const answerOptions = modal.querySelectorAll('.answer-option');
            let selectedOption = selectedAnswers[questionId];
            
            answerOptions.forEach(option => {
                option.addEventListener('click', () => {
                    answerOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    selectedOption = option.dataset.option;
                });
            });
            
            document.getElementById('save-answer').addEventListener('click', () => {
                if (selectedOption) {
                    saveAnswer(questionId, selectedOption, questionCard);
                    document.body.removeChild(modal);
                } else {
                    showNotification('Please select an answer!');
                }
            });
            
            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }

        function saveAnswer(questionId, answer, questionCard) {
            // Check if question already selected
            const existingIndex = selectedQuestions.indexOf(questionId);
            
            if (existingIndex === -1) {
                // Add new question if less than 10
                if (selectedQuestions.length < 10) {
                    selectedQuestions.push(questionId);
                    selectedAnswers[questionId] = answer;
                    questionCard.classList.add('selected');
                    
                    // Show selected answer
                    const selectedText = questionCard.querySelector('.selected-text');
                    const selectedDiv = questionCard.querySelector('.selected-answer');
                    selectedText.textContent = answer;
                    selectedDiv.style.display = 'block';
                } else {
                    showNotification('Maximum 10 questions allowed!');
                    return;
                }
            } else {
                // Update existing answer
                selectedAnswers[questionId] = answer;
                const selectedText = questionCard.querySelector('.selected-text');
                selectedText.textContent = answer;
            }
            
            updateSelectionUI();
            validateForm();
        }

        function updateSelectionUI() {
            const count = selectedQuestions.length;
            const countElement = document.getElementById('selected-count');
            const progressBar = document.getElementById('progress-bar');
            const counterText = document.getElementById('selection-counter');
            
            countElement.textContent = `${count}/10`;
            progressBar.style.width = `${(count / 10) * 100}%`;
            
            if (count === 10) {
                counterText.innerHTML = '<i class="bx bx-check" style="color: var(--primary-color);"></i> All 10 questions selected!';
                countElement.style.background = '#28a745';
            } else {
                counterText.textContent = `Select ${10 - count} more questions`;
                countElement.style.background = 'var(--primary-color)';
            }
        }

        function validateForm() {
            const nickname = document.getElementById('nickname').value.trim();
            const createBtn = document.getElementById('create-btn');
            
            if (nickname.length >= 2 && selectedQuestions.length === 10) {
                createBtn.disabled = false;
                createBtn.innerHTML = '<i class="bx bx-check-circle"></i> Create My Quiz';
            } else {
                createBtn.disabled = true;
                createBtn.innerHTML = '<i class="bx bx-check-circle"></i> Select 10 Questions';
            }
        }

        async function createQuiz() {
            const nickname = document.getElementById('nickname').value.trim();
            
            if (!nickname || selectedQuestions.length !== 10) {
                showNotification('Please complete all requirements!');
                return;
            }
            
            // Show loading
            const btn = document.getElementById('create-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="bx bx-loader-alt bx-spin"></i> Creating...';
            btn.disabled = true;
            
            try {
                // Prepare quiz data
                const quizData = {
                    ownerName: nickname,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    questions: selectedQuestions.map(id => {
                        const question = QUESTIONS.find(q => q.id === id);
                        return {
                            id: question.id,
                            text: question.text,
                            options: question.options,
                            correctAnswer: selectedAnswers[id]
                        };
                    })
                };
                
                // Save to Firestore
                const quizRef = await db.collection('quizzes').add(quizData);
                const quizId = quizRef.id;
                
                // Save to local storage for history
                saveQuizToHistory(quizId, nickname);
                
                // Redirect to share page
                window.location.href = `share.html?quiz=${quizId}`;
                
            } catch (error) {
                console.error('Error creating quiz:', error);
                showNotification('Error creating quiz. Please try again!');
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        function saveQuizToHistory(quizId, nickname) {
            const history = JSON.parse(localStorage.getItem('friends_quiz_history') || '[]');
            history.unshift({
                id: quizId,
                name: nickname,
                date: new Date().toISOString()
            });
            
            // Keep only last 10 quizzes
            if (history.length > 10) {
                history.pop();
            }
            
            localStorage.setItem('friends_quiz_history', JSON.stringify(history));
        }

        function showNotification(message) {
            // Remove existing notification
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();
            
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>
